{{ 'customer-reviews-slider.css' | asset_url | stylesheet_tag }}

<div class="reviews-section" style="background-color: {{ section.settings.bg_color }}; padding: {{ section.settings.padding_top }}px 0 {{ section.settings.padding_bottom }}px;">
  <div class="reviews-container">
    {% if section.settings.title != blank %}
      <h2 class="reviews-title" style="color: {{ section.settings.title_color }};">{{ section.settings.title }}</h2>
    {% endif %}
    {% if section.settings.subtitle != blank %}
      <p class="reviews-subtitle" style="color: {{ section.settings.subtitle_color }};">{{ section.settings.subtitle }}</p>
    {% endif %}

    <div class="reviews-slider">
      {% if section.settings.show_navigation %}
        <button class="nav-btn prev" aria-label="Previous">‹</button>
        <button class="nav-btn next" aria-label="Next">›</button>
      {% endif %}
      <div class="reviews-track">
        {% for block in section.blocks %}
          <div class="review-card" data-block-id="{{ block.id }}">
            <div class="stars">
              {% for i in (1..block.settings.rating) %}
                <span class="star">★</span>
              {% endfor %}
            </div>
            <p class="review-text">{{ block.settings.review_text }}</p>
            <p class="customer-name">{{ block.settings.customer_name }}</p>
            <p class="customer-location">{{ block.settings.customer_location }}</p>
          </div>
        {% endfor %}
      </div>
    </div>
  </div>
</div>

<script>
  const slider = document.querySelector('.reviews-slider');
  const track = slider.querySelector('.reviews-track');
  const cards = track.querySelectorAll('.review-card');
  let current = 0;

  function updateSlider() {
    cards.forEach((card, i) => {
      card.classList.remove('active', 'prev', 'next');
      if (i === current) card.classList.add('active');
      else if (i === current - 1 || (current === 0 && i === cards.length - 1)) card.classList.add('prev');
      else if (i === current + 1 || (current === cards.length - 1 && i === 0)) card.classList.add('next');
    });
  }

  function next() {
    current = (current + 1) % cards.length;
    updateSlider();
  }

  function prev() {
    current = (current - 1 + cards.length) % cards.length;
    updateSlider();
  }

  {% if section.settings.autoplay %}
    setInterval(next, {{ section.settings.autoplay_speed }} * 1000);
  {% endif %}

  document.querySelector('.nav-btn.next')?.addEventListener('click', next);
  document.querySelector('.nav-btn.prev')?.addEventListener('click', prev);

  updateSlider();
</script>

{% schema %}
{
  "name": "Customer Reviews Slider",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Title",
      "default": "Customer Reviews"
    },
    {
      "type": "color",
      "id": "title_color",
      "label": "Title Color",
      "default": "#000000"
    },
    {
      "type": "textarea",
      "id": "subtitle",
      "label": "Subtitle",
      "default": "Real reviews from satisfied customers who transformed their homes"
    },
    {
      "type": "color",
      "id": "subtitle_color",
      "label": "Subtitle Color",
      "default": "#666666"
    },
    {
      "type": "color",
      "id": "bg_color",
      "label": "Background Color",
      "default": "#f9f9f9"
    },
    {
      "type": "range",
      "id": "padding_top",
      "label": "Padding Top",
      "min": 0,
      "max": 100,
      "step": 5,
      "default": 60
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "label": "Padding Bottom",
      "min": 0,
      "max": 100,
      "step": 5,
      "default": 60
    },
    {
      "type": "checkbox",
      "id": "autoplay",
      "label": "Autoplay",
      "default": true
    },
    {
      "type": "range",
      "id": "autoplay_speed",
      "label": "Autoplay Speed (seconds)",
      "min": 2,
      "max": 10,
      "step": 1,
      "default": 5
    },
    {
      "type": "checkbox",
      "id": "show_navigation",
      "label": "Show Navigation Arrows",
      "default": true
    }
  ],
  "blocks": [
    {
      "type": "review",
      "name": "Review",
      "settings": [
        {
          "type": "range",
          "id": "rating",
          "label": "Star Rating",
          "min": 1,
          "max": 5,
          "step": 1,
          "default": 5
        },
        {
          "type": "textarea",
          "id": "review_text",
          "label": "Review Text",
          "default": "Amazing quality! Transformed my living room completely."
        },
        {
          "type": "text",
          "id": "customer_name",
          "label": "Customer Name",
          "default": "Christopher Wilson"
        },
        {
          "type": "text",
          "id": "customer_location",
          "label": "Location",
          "default": "Los Angeles, CA"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Customer Reviews Slider",
      "blocks": [
        {
          "type": "review"
        },
        {
          "type": "review"
        },
        {
          "type": "review"
        }
      ]
    }
  ]
}
{% endschema %}
